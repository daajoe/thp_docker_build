#!/usr/bin/env bash
#
# Copyright Norbert Manthey, 2019
#
# This script prepares the directory to build a MiniSat based PoC

# in case something goes wrong, notify!
#set -xe

# get glibc upstream, and jump to tag 2.23, in case it's not there already
if [ ! -d glibc ]
then
    echo "Downloading glibc..."
    #git clone git://sourceware.org/git/glibc.git
    pushd glibc/
    #git checkout glibc-2.23

    echo "Applying patches..."
    successful=0
    # apply patches in order
    for p in $(ls ../../thp-env-2.23/*.patch | sort -V)
    do
	echo $p
	git apply "$p"
    done
    
    popd
    echo "Done."
    exit 10
else
    echo "glibc found."
    exit 20
fi
